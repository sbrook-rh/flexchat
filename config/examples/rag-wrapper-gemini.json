{
  "$schema": "../schema/config-schema.json",
  "comment": "RAG configuration using ChromaDB wrapper with Gemini API for chat and embeddings",
  
  "providers": {
    "gemini": {
      "type": "gemini",
      "apiKey": "${GEMINI_API_KEY}",
      "models": {
        "chat": "gemini-1.5-flash"
      },
      "embedding_model": "text-embedding-004",
      "comment": [
        "Requires GEMINI_API_KEY environment variable.",
        "Get key from: https://makersuite.google.com/app/apikey",
        "text-embedding-004 is Gemini's latest embedding model (768 dimensions)"
      ]
    }
  },
  
  "knowledge_bases": {
    "dynamic": {
      "type": "chromadb-wrapper",
      "url": "http://localhost:5006",
      "embedding_provider": "gemini",
      "comment": [
        "ChromaDB wrapper is a Python FastAPI service that handles embeddings and storage.",
        "Start it with: cd backend/rag && python server.py",
        "The wrapper's .env file should have: EMBEDDING_PROVIDER=gemini, EMBEDDING_MODEL=text-embedding-004, GEMINI_API_KEY=your_key",
        "Collections are created via the UI at http://localhost:5173/collections"
      ]
    }
  },
  
  "detection_provider": {
    "provider": "gemini",
    "model": "gemini-1.5-flash",
    "comment": "Used for LLM-based intent detection when RAG fallback threshold is triggered"
  },
  
  "strategies": [
    {
      "name": "DYNAMIC_RAG",
      "comment": [
        "Matches any collection from the 'dynamic' knowledge base.",
        "Each collection can have its own metadata (system_prompt, thresholds, etc.)",
        "created via the UI. This strategy provides defaults that collections can override."
      ],
      "detection": {
        "type": "rag",
        "knowledge_base": "dynamic",
        "threshold": 0.3,
        "fallback_threshold": 0.5,
        "comment": [
          "threshold: Direct match - uses RAG context immediately",
          "fallback_threshold: Maybe relevant - asks LLM to decide, then uses RAG if LLM picks this",
          "Collections can override these thresholds in their metadata"
        ]
      },
      "response": {
        "provider": "gemini",
        "model": "gemini-1.5-flash",
        "system_prompt": "You are a knowledgeable Red Hat assistant. Answer based on the provided context from our documentation.",
        "max_tokens": 800,
        "temperature": 0.7,
        "comment": "Collections can override system_prompt, max_tokens, and temperature in their metadata"
      }
    },
    {
      "name": "GENERAL",
      "comment": "Fallback for off-topic or unmatched queries",
      "detection": {
        "type": "default"
      },
      "response": {
        "provider": "gemini",
        "model": "gemini-1.5-flash",
        "system_prompt": "You are a helpful Red Hat assistant. This query appears to be outside your knowledge base. Politely indicate that you specialize in Red Hat products and suggest they ask relevant questions.",
        "max_tokens": 150,
        "temperature": 0.7
      }
    }
  ]
}

